################################################################################
## Everyone leaves or someone comes home
################################################################################
- id: alert_when_everyone_leaves_home
  alias: 'Alert when everyone leaves home'
  trigger:
    platform: state
    entity_id: sensor.anyone_home
    to: 'not_home'
  action:
    - service: notify.ios_jeff_phone
      data_template:
        title: "Presence"
        message: "Everyone has left home"

- id: alert_when_anyone_comes_home
  alias: 'Alert when anyone comes home'
  trigger:
    platform: state
    entity_id: sensor.anyone_home
    to: 'home'
  action:
    - service: notify.ios_jeff_phone
      data_template:
        title: "Presence"
        message: "Someone came home"


################################################################################
## Set BI profile when we leave or come home
################################################################################
- id: set_bi_day_when_home 
  alias: Presence - Set BI day when we get home
  trigger:
    - platform: state
      entity_id: sensor.anyone_home
      to: 'home'
  condition:
    condition: sun
    after: sunrise
    after_offset: "00:30:00"
    before: sunset
    before_offset: "-01:00:00"
  action:
    - service: input_select.select_option
      data_template:
        entity_id: input_select.set_biprofile
        option: 'day'

- id: set_bi_alert_day_when_leave 
  alias: Presence - Set BI alert_day when we leave
  trigger:
    - platform: state
      entity_id: sensor.anyone_home
      to: 'not_home'
  condition:
    condition: sun
    after: sunrise
    after_offset: "00:30:00"
    before: sunset
    before_offset: "-01:00:00"
  action:
    - service: input_select.select_option
      data_template:
        entity_id: input_select.set_biprofile
        option: 'alert_day'

- id: set_bi_alert_night_when_leave
  alias: Presence - Set BI alert_night when we leave
  trigger:
    - platform: state
      entity_id: sensor.anyone_home
      to: 'not_home'
  condition:
    condition: sun
    after: sunset
    after_offset: "-01:00:00"
    before: sunrise
  action:
    - service: input_select.select_option
      data_template:
        entity_id: input_select.set_biprofile
        option: 'alert_night'

- id: set_bi_night_when_home_before_10pm 
  alias: Presence - Set BI night when we get home before 10pm
  trigger:
    - platform: state
      entity_id: sensor.anyone_home
      to: 'home'
  condition:
    condition: and
    conditions:
      - condition: sun
        after: sunset
        before: sunrise
      - condition: time
        before: '22:00'
  action:
    - service: input_select.select_option
      data_template:
        entity_id: input_select.set_biprofile
        option: 'night'

- id: set_bi_alert_night_when_home_after_10pm 
  alias: Presence - Set BI alert_night when we get home after 10pm
  trigger:
    - platform: state
      entity_id: sensor.anyone_home
      to: 'home'
  condition:
    condition: and
    conditions:
      - condition: sun
        after: sunset
        before: sunrise
      - condition: time
        after: '22:00'
  action:
    - service: input_select.select_option
      data_template:
        entity_id: input_select.set_biprofile
        option: 'alert_night'
