################################################
## Custom alerts
################################################
- id: alert_when_door_open_for_too_long
  alias: 'Alert when door to garage is opened for too long'
  trigger:
    platform: state
    entity_id: binary_sensor.garage_door
    from: 'off'
    to: 'on'
    for:
      seconds: 300
  action:
    # - service: notify.slack
    #   data_template:
    #     title: "Alarm Panel"
    #     message: "Door to garage is opened for more than 5 minutes"
    - service: notify.ios_jeff_phone
      data_template:
        title: "Alarm Panel"
        message: "Door to garage is opened for more than 5 minutes"
    - service: notify.ios_jen_phone
      data_template:
        title: "Alarm Panel"
        message: "Door to garage is opened for more than 5 minutes"

- id: alert_when_basement_door_open_for_too_long
  alias: 'Alert when basement door is opened for too long'
  initial_state: on
  trigger:
    platform: state
    entity_id: binary_sensor.basement_door
    from: 'off'
    to: 'on'
    for:
      seconds: 300
  action:
    # - service: notify.slack
    #   data_template:
    #     title: "Alarm Panel"
    #     message: "Basement door is opened for more than 5 minutes"
    - service: notify.ios_jeff_phone
      data_template:
        title: "Alarm Panel"
        message: "Basement door is opened for more than 5 minutes"
    - service: notify.ios_jen_phone
      data_template:
        title: "Alarm Panel"
        message: "Basement door is opened for more than 5 minutes"


- id: alert_when_front_door_open_for_too_long
  alias: 'Alert when front door is opened for too long'
  initial_state: on
  trigger:
    platform: state
    entity_id: binary_sensor.front_door
    from: 'off'
    to: 'on'
    for:
      seconds: 300
  action:
    # - service: notify.slack
    #   data_template:
    #     title: "Alarm Panel"
    #     message: "Front door is opened for more than 5 minutes"
    - service: notify.ios_jeff_phone
      data_template:
        title: "Alarm Panel"
        message: "Front door is opened for more than 5 minutes"
    - service: notify.ios_jen_phone
      data_template:
        title: "Alarm Panel"
        message: "Front door is opened for more than 5 minutes"

- id: alert_when_sun_room_door_open_for_too_long
  alias: 'Alert when sun room door is opened for too long'
  trigger:
    platform: state
    entity_id: binary_sensor.sun_room_door
    from: 'off'
    to: 'on'
    for:
      seconds: 300
  action:
    # - service: notify.slack
    #   data_template:
    #     title: "Alarm Panel"
    #     message: "Sun room door is opened for more than 5 minutes"
    - service: notify.ios_jeff_phone
      data_template:
        title: "Alarm Panel"
        message: "Sun room door is opened for more than 5 minutes"
    - service: notify.ios_jen_phone
      data_template:
        title: "Alarm Panel"
        message: "Sun room door is opened for more than 5 minutes"

- id: alert_when_unknown_door_open_for_too_long
  alias: 'Alert when unknown door is opened for too long'
  initial_state: on
  trigger:
    platform: state
    entity_id: binary_sensor.unknown_door
    from: 'off'
    to: 'on'
    for:
      seconds: 300
  action:
    # - service: notify.slack
    #   data_template:
    #     title: "Alarm Panel"
    #     message: "Unknown door is opened for more than 5 minutes"
    - service: notify.ios_jeff_phone
      data_template:
        title: "Alarm Panel"
        message: "Unknown door is opened for more than 5 minutes"
    - service: notify.ios_jen_phone
      data_template:
        title: "Alarm Panel"
        message: "Unknown door is opened for more than 5 minutes"

################################################
## All door/window sensors
################################################
- id: alert_when_upstairs_motion
  alias: 'Alert when motion is detected upstairs and nobody home'
  trigger:
    platform: state
    entity_id: binary_sensor.upstairs_motion
    from: 'off'
    to: 'on'
  condition:
      condition: state
      entity_id: sensor.anyone_home
      state: 'not_home'
  action:
    # - service: notify.slack
    #   data_template:
    #     title: "Alarm Panel"
    #     message: "Upstairs motion detected"
    - service: notify.ios_jeff_phone
      data_template:
        title: "Alarm Panel"
        message: "Upstairs motion detected"

- id: alert_when_main_motion
  alias: 'Alert when motion is detected on the main level and nobody home'
  trigger:
    platform: state
    entity_id: binary_sensor.main_motion
    from: 'off'
    to: 'on'
  condition:
      condition: state
      entity_id: sensor.anyone_home
      state: 'not_home'
  action:
    # - service: notify.slack
    #   data_template:
    #     title: "Alarm Panel"
    #     message: "Main level motion detected"
    - service: notify.ios_jeff_phone
      data_template:
        title: "Alarm Panel"
        message: "Main level motion detected"

- id: alert_when_basement_motion
  alias: 'Alert when motion is detected in the basement and nobody home'
  trigger:
    platform: state
    entity_id: binary_sensor.basement_motion
    from: 'off'
    to: 'on'
  condition:
      condition: state
      entity_id: sensor.anyone_home
      state: 'not_home'
  action:
    # - service: notify.slack
    #   data_template:
    #     title: "Alarm Panel"
    #     message: "Basement motion detected"
    - service: notify.ios_jeff_phone
      data_template:
        title: "Alarm Panel"
        message: "Basement motion detected"

- id: alert_when_front_door_open
  alias: 'Alert when front door is open and nobody home'
  initial_state: on
  trigger:
    platform: state
    entity_id: binary_sensor.front_door
    from: 'off'
    to: 'on'
  condition:
      condition: state
      entity_id: sensor.anyone_home
      state: 'not_home'
  action:
    # - service: notify.slack
    #   data_template:
    #     title: "Alarm Panel"
    #     message: "Front door open"
    - service: notify.ios_jeff_phone
      data_template:
        title: "Alarm Panel"
        message: "Front door open"

- id: alert_when_garage_door_open
  alias: 'Alert when garage door is open and nobody home'
  initial_state: on
  trigger:
    platform: state
    entity_id: binary_sensor.garage_door
    from: 'off'
    to: 'on'
  condition:
      condition: state
      entity_id: sensor.anyone_home
      state: 'not_home'
  action:
    # - service: notify.slack
    #   data_template:
    #     title: "Alarm Panel"
    #     message: "Garage door open"
    - service: notify.ios_jeff_phone
      data_template:
        title: "Alarm Panel"
        message: "Garage door open"

- id: alert_when_family_window_open
  alias: 'Alert when family window is open and nobody home'
  initial_state: on
  trigger:
    platform: state
    entity_id: binary_sensor.family_window
    from: 'off'
    to: 'on'
  condition:
      condition: state
      entity_id: sensor.anyone_home
      state: 'not_home'
  action:
    # - service: notify.slack
    #   data_template:
    #     title: "Alarm Panel"
    #     message: "Family window open"
    - service: notify.ios_jeff_phone
      data_template:
        title: "Alarm Panel"
        message: "Family window open"

- id: alert_when_living_window_open
  alias: 'Alert when living window is open and nobody home'
  initial_state: on
  trigger:
    platform: state
    entity_id: binary_sensor.living_window
    from: 'off'
    to: 'on'
  condition:
      condition: state
      entity_id: sensor.anyone_home
      state: 'not_home'
  action:
    # - service: notify.slack
    #   data_template:
    #     title: "Alarm Panel"
    #     message: "Living window open"
    - service: notify.ios_jeff_phone
      data_template:
        title: "Alarm Panel"
        message: "Living window open"

- id: alert_when_sun_room_door_open
  alias: 'Alert when sun room door is open and nobody home'
  initial_state: on
  trigger:
    platform: state
    entity_id: binary_sensor.sun_room_door
    from: 'off'
    to: 'on'
  condition:
      condition: state
      entity_id: sensor.anyone_home
      state: 'not_home'
  action:
    # - service: notify.slack
    #   data_template:
    #     title: "Alarm Panel"
    #     message: "Sun Room Door open"
    - service: notify.ios_jeff_phone
      data_template:
        title: "Alarm Panel"
        message: "Sun Room Door open"

- id: alert_when_basement_window_open
  alias: 'Alert when basement window is open and nobody home'
  initial_state: on
  trigger:
    platform: state
    entity_id: binary_sensor.basement_window
    from: 'off'
    to: 'on'
  condition:
      condition: state
      entity_id: sensor.anyone_home
      state: 'not_home'
  action:
    # - service: notify.slack
    #   data_template:
    #     title: "Alarm Panel"
    #     message: "Basement Window open"
    - service: notify.ios_jeff_phone
      data_template:
        title: "Alarm Panel"
        message: "Basement Window open"

- id: alert_when_bathroom_window_open
  alias: 'Alert when bathroom window is open and nobody home'
  initial_state: on
  trigger:
    platform: state
    entity_id: binary_sensor.bathroom_window
    from: 'off'
    to: 'on'
  condition:
      condition: state
      entity_id: sensor.anyone_home
      state: 'not_home'
  action:
    # - service: notify.slack
    #   data_template:
    #     title: "Alarm Panel"
    #     message: "Bathroom Window open"
    - service: notify.ios_jeff_phone
      data_template:
        title: "Alarm Panel"
        message: "Bathroom Window open"

- id: alert_when_kitchen_window_open
  alias: 'Alert when kitchen window is open and nobody home'
  initial_state: on
  trigger:
    platform: state
    entity_id: binary_sensor.kitchen_window
    from: 'off'
    to: 'on'
  condition:
      condition: state
      entity_id: sensor.anyone_home
      state: 'not_home'
  action:
    # - service: notify.slack
    #   data_template:
    #     title: "Alarm Panel"
    #     message: "Kitchen Window open"
    - service: notify.ios_jeff_phone
      data_template:
        title: "Alarm Panel"
        message: "Kitchen Window open"

- id: alert_when_unknown_door_open
  alias: 'Alert when unknown door is open and nobody home'
  initial_state: on
  trigger:
    platform: state
    entity_id: binary_sensor.unknown_door
    from: 'off'
    to: 'on'
  condition:
      condition: state
      entity_id: sensor.anyone_home
      state: 'not_home'
  action:
    # - service: notify.slack
    #   data_template:
    #     title: "Alarm Panel"
    #     message: "Unknown Door open"
    - service: notify.ios_jeff_phone
      data_template:
        title: "Alarm Panel"
        message: "Unknown Door open"

- id: alert_when_laundry_window_open
  alias: 'Alert when laundry window is open and nobody home'
  initial_state: on
  trigger:
    platform: state
    entity_id: binary_sensor.laundry_window
    from: 'off'
    to: 'on'
  condition:
      condition: state
      entity_id: sensor.anyone_home
      state: 'not_home'
  action:
    # - service: notify.slack
    #   data_template:
    #     title: "Alarm Panel"
    #     message: "Laundry Window open"
    - service: notify.ios_jeff_phone
      data_template:
        title: "Alarm Panel"
        message: "Laundry Window open"

- id: alert_when_basement_door_open
  alias: 'Alert when basement door is open and nobody home'
  initial_state: on
  trigger:
    platform: state
    entity_id: binary_sensor.basement_door
    from: 'off'
    to: 'on'
  condition:
      condition: state
      entity_id: sensor.anyone_home
      state: 'not_home'
  action:
    # - service: notify.slack
    #   data_template:
    #     title: "Alarm Panel"
    #     message: "Basement Door open"
    - service: notify.ios_jeff_phone
      data_template:
        title: "Alarm Panel"
        message: "Basement Door open"

- id: alert_when_sliding_door_open
  alias: 'Alert when sliding door is open and nobody home'
  trigger:
    platform: state
    entity_id: binary_sensor.sliding_door
    from: 'off'
    to: 'on'
  condition:
      condition: state
      entity_id: sensor.anyone_home
      state: 'not_home'
  action:
    # - service: notify.slack
    #   data_template:
    #     title: "Alarm Panel"
    #     message: "Sliding Door open"
    - service: notify.ios_jeff_phone
      data_template:
        title: "Alarm Panel"
        message: "Sliding Door open"

- id: alert_when_upstairs_window_open
  alias: 'Alert when upstairs window is open and nobody home'
  initial_state: on
  trigger:
    platform: state
    entity_id: binary_sensor.upstairs_window
    from: 'off'
    to: 'on'
  condition:
      condition: state
      entity_id: sensor.anyone_home
      state: 'not_home'
  action:
    # - service: notify.slack
    #   data_template:
    #     title: "Alarm Panel"
    #     message: "Upstairs Window open"
    - service: notify.ios_jeff_phone
      data_template:
        title: "Alarm Panel"
        message: "Upstairs Window open"

################################################
## Notify about alarm panel changes
################################################
# - id: notify_alarm_triggered
#   alias: 'Notify Alarm triggered'
#   initial_state: on
#   trigger:
#     platform: state
#     entity_id: alarm_control_panel.alarm_panel
#     to: 'triggered'
#   action:
#     - service: notify.slack
#       data_template:
#         title: "Alarm Panel"
#         message: "@here Alarm has triggered: {{states('sensor.alarm_panel_display')}}"
#     - service: notify.ios_jeff_phone
#       data_template:
#         title: "Alarm Panel"
#         message: "Alarm has triggered: {{states('sensor.alarm_panel_display')}}"
#         data:
#           push:
#             badge: 5
#             category: "alarm"
#             sound: "US-EN-Morgan-Freeman-Vacate-The-Premises.wav"
#     - service: notify.ios_jen_phone
#       data_template:
#         title: "Alarm Panel"
#         message: "Alarm has triggered: {{states('sensor.alarm_panel_display')}}"
#         data:
#           push:
#             badge: 5
#             category: "alarm"

# - id: notify_alarm_armed
#   alias: 'Notify Alarm Armed'
#   trigger:
#     platform: state
#     entity_id: sensor.alarm_status
#     from: 'Disarmed'
#     to: 'Armed'
#   action:
#     - service: notify.slack
#       data_template:
#         title: "Alarm Panel"
#         message: "Alarm is ARMED"
#     - service: notify.ios_jeff_phone
#       data_template:
#         title: "Alarm Panel"
#         message: "Alarm is ARMED"
#     - service: notify.ios_jen_phone
#       data_template:
#         title: "Alarm Panel"
#         message: "Alarm is ARMED"

# - id: notify_alarm_disarmed
#   alias: 'Notify Alarm Disarmed'
#   trigger:
#     platform: state
#     entity_id: sensor.alarm_status
#     from: 'Armed'
#     to: 'Disarmed'
#   action:
#     - service: notify.slack
#       data_template:
#         title: "Alarm Panel"
#         message: "Alarm is Disarmed"
#     - service: notify.ios_jeff_phone
#       data_template:
#         title: "Alarm Panel"
#         message: "Alarm is Disarmed"
#     - service: notify.ios_jen_phone
#       data_template:
#         title: "Alarm Panel"
#         message: "Alarm is Disarmed"

################################################
## Auto arming & disarming
################################################
# - id: arm_alarm_nobody_home
#   alias: 'Arm Alarm when Nobody Home'
#   initial_state: on
#   trigger:
#     platform: state
#     entity_id: sensor.anyone_home
#     from: 'home'
#     to: 'not_home'
#     #    for:
#     #      minutes: 2
#   condition:
#     condition: state
#     entity_id: input_select.alarm_mode
#     state: 'automatic'
#   action:
#     - service: alarm_control_panel.alarm_arm_night
#       data:
#         entity_id: alarm_control_panel.alarm_panel
#         code: !secret ALARMCD

# - id: disarm_alarm_anybody_home
#   alias: 'Disarm alarm when anybody comes home'
#   initial_state: on
#   trigger:
#     platform: state
#     entity_id: sensor.anyone_home
#     from: 'not_home'
#     to: 'home'
#   condition:
#     condition: state
#     entity_id: input_select.alarm_mode
#     state: 'automatic'
#   action:
#     - service: alarm_control_panel.alarm_disarm
#       data:
#         entity_id: alarm_control_panel.alarm_panel
#         code: !secret ALARMCD

- id: ios_action_disarm_alarm
  alias: 'iOS action to disarm alarm'
  initial_state: on
  trigger:
    - platform: event
      event_type: ios.notification_action_fired
      event_data:
        actionName: DISARM_ALARM
  action:
    - service: alarm_control_panel.alarm_disarm
      data:
        entity_id: alarm_control_panel.alarm_panel
        code: !secret ALARMCD

################################################
## Tensorflow
################################################

# - id: notifty_slack_tensorflow_image
#   alias: 'Notify Slack Tensorflow Image'
#   initial_state: on
#   trigger:
#     platform: state
#     entity_id: image_processing.tensorflow_basement, image_processing.tensorflow_porch, image_processing.tensorflow_driveway, image_processing.tensorflow_front, image_processing.tensorflow_pool
#   condition:
#     condition: template
#     value_template: '{{ trigger.to_state.state |int > 0 }}'
#   action:
#   - service: notify.slack
#     data:
#       message: "Camera tensorflow snapshot"
#       title: "Camera tensorflow match"
#       data:
#         file:
#           path: "/config/tensorflow/snapshot/{{ trigger.entity_id.split('.')[1].replace('tensorflow_', '') }}_latest.jpg"

